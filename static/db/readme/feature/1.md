# Валидация форм в react приложении

Данных подход к валидации форм включает в себя 4 составляющие

1. валидаторы
2. хуки для инпутов
3. хук для формы
4. разметку

Поскольку валидаторы это простые функции, которые не должны зависеть от какого-либо фреймворка/библиотеки, они вынесены в отдельную фичу: [кроссплатформенная система валидации форм](https://robzarel.github.io/features/feature/0).

Сами же хуки содержат в себе модель работы с полями

### Типы

```typescript
type DefaultField = {
  id: string;
  value: string;
  error: null | string;
  hasError: () => Promise<boolean>;
};
```

Плюс каждый хук расширяет DefaultField в зависимости от своего функционала

### Список хуков:

#### Форма

- [useForm](https://robzarel.github.io/features/snippet/10) - для контроля отправки формы и запуска валидаторов по триггеру сабмита

#### Инпуты

- [useTextFormField](https://robzarel.github.io/features/snippet/11) - текстовые поля
- [useRadioFormField](https://robzarel.github.io/features/snippet/12) - радио
- [useCustomSelectFormField](https://robzarel.github.io/features/snippet/13) - селект
- [useFilesFormField](https://robzarel.github.io/features/snippet/14) - файлы

### Применение

Связка: [кроссплатформенная система валидации форм](https://robzarel.github.io/features/feature/0) + хуки инпутов + хук формы

Например страница выгрузки статистики за определённый период создаётся в 3 простых шага:

1. создание модели данных для поля ввода, с использованием кастомного хука `useRadioFormField`
2. создание модели данных для всей формы, с использованием кастомного хука `useForm`
3. отображение в разметке

```typescript
function StatisticsPage() {
  // cоздаём модель данных для поля ввода
  const period = useRadioFormField(
    'period', // name
    [required()], // validators array
    options.period[0].value // value
  );

  const endDate = new Date();
  const startDate = getStartDate(period.value, endDate);

  // cоздаём модель данных для формы
  // RadioField - тип, экспортируемый из useRadioFormField, описывающий модель данных
  // ApiResponse - тип, описывающий модель данных, возвращаемых вашим апи хендлером.
  const form = useForm<RadioField, ApiResponse>({
    fields: [purpose, period],
    apiCall: () =>
      api.get.statistic() /* your fetch request, that returns promise */,
    onSuccess: () => {
      /* some onSuccess handler*/
    },
  });

  return (
    <div className={Styles.layout}>
      <header className={Styles.header}>
        <h1 className={Styles.title}>Статистика</h1>
      </header>
      <main className={Styles.main}>
        <form className={Styles.form} onSubmit={form.handleFormSubmit}>
          <fieldset className={Styles.fieldset}>
            <p className={Styles.label}>Период</p>
            <div className={Styles.radio}>
              <Radio
                selected={period.value}
                name={period.id}
                onChange={period.handleChange}
                options={options.period}
              />
            </div>
          </fieldset>
          <div className={Styles.submitWrapper}>
            <button
              type='submit'
              className={Styles.submitButton}
              disabled={form.isSending || form.hasFieldErrors} // отключаем кнопку на время отправки или в случае найденных ошибок
            >
              Получить
            </button>
            // крутим крутилку пока запрос активный
            {form.isSending && (
              <div className={Styles.loader}>
                <Preloader />
              </div>
            )}
            // сообщение об ошибке, если оно есть
            {form.sendingError && (
              <p className={Styles.error}>{form.sendingError}</p>
            )}
          </div>
        </form>
      </main>
    </div>
  );
}
```
